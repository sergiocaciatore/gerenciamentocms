
<style>

  /* Modal container */

  #mills-modal {
    display: none; /* começa escondido */
    background: #fff;
    border-radius: 10px;
    padding: 30px 25px;
    max-width: 400px;
    width: 90%;
    margin: 40px auto;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    position: relative;
    box-sizing: border-box;
  }

  /* Form styles */

  #mills-modal h2 {
    font-size: 1.6rem;
    color: #f58220;
    margin-bottom: 5px;
    text-align: center;
  }

  #mills-modal .subtext {
    font-size: 14px;
    color: #666;
    margin-bottom: 20px;
    text-align: center;
    display: block;
  }

  #mills-modal label {
    font-weight: 600;
    color: #333;
    display: block;
    margin-bottom: 6px;
  }

  #mills-modal input {
    width: 100%;
    padding: 12px;
    margin-bottom: 15px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 16px;
    box-sizing: border-box;
  }

  #mills-modal button {
    width: 100%;
    background-color: #00b074;
    color: white;
    padding: 14px;
    font-size: 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-weight: bold;
    transition: background-color 0.3s;
  }

  #mills-modal button:hover {
    background-color: #00915e;
  }

  #mills-modal button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
  }

  /* Responsividade */

  @media(max-width: 450px){
    #mills-modal {
      padding: 25px 15px;
    }

    #mills-modal h2 {
      font-size: 1.4rem;
    }

    #mills-modal input {
      font-size: 14px;
    }

    #mills-modal button {
      font-size: 14px;
      padding: 12px;
    }

  }
</style>
<!-- Apenas o Modal -->
<div id="mills-modal">
<h2>Fale com um especialista</h2>
<p class="subtext">Informe seus dados para começarmos a conversa</p>
<form id="form-whatsapp-modal">
<label for="nome-modal">Nome *</label>
<input type="text" id="nome-modal" name="nome" placeholder="Ex: João Silva" required>
<label for="email-modal">Email *</label>
<input type="email" id="email-modal" name="email" placeholder="Ex: joao@email.com" required>
<label for="telefone-modal">WhatsApp *</label>
<input type="tel" id="telefone-modal" name="telefone" placeholder="Ex: 11912345678" required>
<button type="submit" id="submit-button-modal">Iniciar Conversa no WhatsApp</button>
</form>
</div>
<script>

  // Abrir modal

  function abrirModal() {
    document.getElementById('mills-modal').style.display = 'block';
  }

  function getURLParams() {
    const params = new URLSearchParams(window.location.search);
    const entries = {};
    for (const [key, value] of params.entries()) {
      if (value) entries[key] = value;
    }
    return entries;
  }

  async function getGeolocation() {
    try {
      const response = await fetch('https://ipwho.is/');
      const data = await response.json();
      return {
        ip: data.ip,
        cidade: data.city,
        estado: data.region,
        pais: data.country,
        operadora: data.connection?.isp || ''
      };
    } catch (e) {
      console.warn("Erro ao buscar geolocalização:", e);
      return {};
    }
  }

  async function enviarWhatsAppModal(e) {
    e.preventDefault();
    const btn = document.getElementById("submit-button-modal");
    btn.disabled = true;
    btn.innerText = "Enviando...";
    let nome = document.getElementById("nome-modal").value.trim();
    let email = document.getElementById("email-modal").value.trim();
    let numero = document.getElementById("telefone-modal").value.trim();
    numero = numero.replace(/\D/g, '');
    if (numero.length === 10 || numero.length === 11) {
      numero = `55${numero}`;
    } else {
      alert("Por favor, digite um número válido com DDD. Ex: 11912345678 ou 1131234567");
      btn.disabled = false;
      btn.innerText = "Iniciar Conversa no WhatsApp";
      return false;
    }

    const baseUrl = `https://yjpw34cswjc4vvvejrk3apsupm0rklci.lambda-url.us-east-2.on.aws/`;
    const urlParams = getURLParams();
    urlParams['nome'] = nome;
    urlParams['email'] = email;
    urlParams['whatsapp'] = numero;
    const geo = await getGeolocation();
    for (const [key, value] of Object.entries(geo)) {
      if (value) urlParams[key] = value;
    }
    urlParams['page_url'] = window.location.href;
    try {
      await fetch(baseUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(urlParams)
      });
    } catch (err) {
      console.error("Erro ao enviar POST:", err);
      alert("Erro ao enviar seus dados. Tente novamente.");
      btn.disabled = false;
      btn.innerText = "Iniciar Conversa no WhatsApp";
      return false;
    }

    // Enviar mensagem personalizada pelo WhatsApp
    const message = `Olá! Meu nome é ${nome}. Meu email é ${email} e meu WhatsApp é ${numero}.`;
    window.location.href = `https://api.whatsapp.com/send/?phone=5511974809431&text=${encodeURIComponent(message)}&type…
    return false;
  }

  // Evento do formulário
  document.getElementById("form-whatsapp-modal").addEventListener("submit", enviarWhatsAppModal);
  // Abrir modal automaticamente
  abrirModal();
</script>
 